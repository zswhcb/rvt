<!DOCTYPE html>
<html lang='zh-CN'>
	<head>
		<title>API测试</title>
		<meta charset='utf-8' />
	</head>
	<body>
		<ol>
			<li>
				<table border='1'>
					<thead>
						<tr>
							<th colspan='2'>登陆</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>用户名：</td>
							<td><input id='F_1_USER_NAME' value='bushuo'></td>
						</tr>
						<tr>
							<td>密码：</td>
							<td><input id='F_1_USER_PASS' type='password' value='1'></td>
						</tr>
					</tbody>
					<tfoot>
						<tr>
							<td colspan='2'>
								<button id='F_1_BTN'>用户登陆</button>
							</td>
						</tr>
					</tfoot>
				</table>
			</li>
			<li>
				<table border='1'>
					<thead>
						<tr>
							<th colspan='2'>结果</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>apikey：</td>
							<td><input id='F_2_APIKEY' type='text'></td>
						</tr>
						<tr>
							<td>seckey：</td>
							<td><input id='F_2_SECKEY' type='text'></td>
						</tr>
						<tr>
							<td>ver：</td>
							<td><input id='F_2_VER' type='text'></td>
						</tr>
					</tbody>
					<tfoot>
						<tr>
							<td colspan='2'>
								<button id='F_2_BTN'>申请任务</button>
							</td>
						</tr>
					</tfoot>
				</table>
			</li>
			<li><a href='javascript:commitTask();'>commitTask</a></li>
		</ol>

		<script type='text/javascript' src='$!{conf.html.cdn}js/jquery/2.0.2/jquery.min.js'></script>
		<!-- Own -->
		<script type='text/javascript'>

		$(function(){
			$('#F_2_BTN').attr('disabled', true);

			$('#F_1_BTN').click(function(){
				ajax({
					command: 'login',
					data: {
						USER_NAME: $('#F_1_USER_NAME').val(),
						USER_PASS: $('#F_1_USER_PASS').val()
					}
				}, function (data){
					$('#F_2_BTN').attr('disabled', !data.success);
					// TODO
					data = data || {};
					// TODO
					var data = data.data || {};
					$('#F_2_APIKEY').val(data.apikey || '');
					$('#F_2_SECKEY').val(data.seckey || '');
					$('#F_2_VER').val(data.ver || '');
				});
			});

			$('#F_2_BTN').click(function(){
				ajax({
					command: 'applyTask',
					ts: (new Date()).getTime(),
					apikey: $('#F_2_APIKEY').val(),
					signature: '',
					data: {}
				}, function (data){
					// TODO
				});
			});
		});

		function commitTask(){
			console.log('commitTask');
		}

		/**
		 *
		 */
		function ajax(postData, cb){
			postData.data = JSON.stringify(postData.data);
			// TODO
			$.ajax({
				url: '/api/',
				type: 'POST',
				dataType: 'JSON',
				data: postData,
				success: function(data){
					cb(data);
				}, error: function(){
					alert(arguments[2]);
				}
			});
		}
		</script>
	</body>
</html>
