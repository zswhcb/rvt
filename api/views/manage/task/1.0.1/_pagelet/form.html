<style>
.WdatePicker {
	background: #fff
		url('$!{conf.html.cdn}js/My97DatePicker/4.8-Beta4/skin/datePicker.gif')
		no-repeat right;
}
</style>
#parse('_macro/select_option.html')
#set($task=$!{data.task})
<form class='form-horizontal' id='addFrm' role='form'
	onsubmit='return false;' data-url=''>
	<input type='hidden' name='id' id='addFrm_id'
		value='$!{task.id}'>
	<div class='form-group'>
		<label class='col-sm-2 hidden-xs control-label'
			for='addFrm_PROJECT_ID'><span class='olx-form-required'>*</span>项目名称</label>
		<div class='col-sm-4'>
			#if(!$data.projects) <input type='text' class='form-control'
				value='$!{task.PROJECT_NAME}' readonly> #else <select
				class='form-control' name='PROJECT_ID' id='addFrm_PROJECT_ID'>
				#m_select_option($!{data.projects}, 'id', 'PROJECT_NAME')
			</select> #end
		</div>
	</div>
	<div class='form-group'>
		<label class='col-sm-2 hidden-xs control-label'
			for='addFrm_create_user_id'><span class='olx-form-required'>*</span>发布人</label>
		<div class='col-sm-4'>
			#if(!$data.users) <input type='text' class='form-control'
				value='$!{task.CREATE_USER_NAME}' readonly> #else
			<div class="input-group">
				<input type="text" aria-label="Text input with dropdown button"
					class="form-control" id='addFrm_create_user_name' placeholder='发布人'>
				<input type="hidden" aria-label="Text input with dropdown button"
					class="form-control" name='create_user_id'
					id='addFrm_create_user_id'>
				<div class="input-group-btn">
					<button aria-expanded="false" aria-haspopup="true"
						data-toggle="dropdown" class="btn btn-default dropdown-toggle"
						type="button">
						选择 <span class="caret"></span>
					</button>
					<ul class="dropdown-menu dropdown-menu-right">
						#foreach($!doc in $!data.users)<li><a href='javascript:;'
							onclick='selItem("$!{doc.id}", "$!{doc.USER_NAME}");'>$!{doc.USER_NAME}</a>
						</li>#end
					</ul>
				</div>
			</div>#end
		</div>
	</div>
	<div class='form-group'>
		<label class='col-sm-2 hidden-xs control-label' for='addFrm_TASK_NAME'><span
			class='olx-form-required'>*</span>任务名称</label>
		<div class='col-sm-4'>
			<input type='text' class='form-control' name='TASK_NAME'
				id='addFrm_TASK_NAME' placeholder='任务名称'
				value='$!{task.TASK_NAME}'>
		</div>
	</div>
	<div class='form-group'>
		<label class='col-sm-2 hidden-xs control-label' for='addFrm_TASK_SUM'><span
			class='olx-form-required'>*</span>任务数量</label>
		<div class='col-sm-4'>
			<input type='text' class='form-control' name='TASK_SUM'
				id='addFrm_TASK_SUM' placeholder='任务数量'
				value='$!{task.TASK_SUM}'>
		</div>
	</div>
	<div class='form-group'>
		<label class='col-sm-2 hidden-xs control-label'
			for='addFrm_TALK_TIME_MIN'><span class='olx-form-required'>*</span>最小时长（秒）</label>
		<div class='col-sm-4'>
			<input type='text' class='form-control' name='TALK_TIME_MIN'
				id='addFrm_TALK_TIME_MIN' placeholder='最小时长（秒）'
				value='$!{task.TALK_TIME_MIN}'>
		</div>
	</div>
	<div class='form-group'>
		<label class='col-sm-2 hidden-xs control-label'
			for='addFrm_TALK_TIMEOUT'><span class='olx-form-required'>*</span>超时时长（秒）</label>
		<div class='col-sm-4'>
			<input type='text' class='form-control' name='TALK_TIMEOUT'
				id='addFrm_TALK_TIMEOUT' placeholder='超时时长（秒）'
				value='$!{task.TALK_TIMEOUT}'>
		</div>
	</div>
	<div class='form-group'>
		<label class='col-sm-2 hidden-xs control-label'
			for='addfrm_START_TIME'><span class='olx-form-required'>*</span>开始时间</label>
		<div class='col-sm-4'>
			<input type='text' class='form-control WdatePicker' name='START_TIME'
				id='addfrm_START_TIME' placeholder='开始时间'
				value='$!{task.START_TIME}'
				onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',maxDate:'#F{$dp.$D(\'addfrm_END_TIME\')}'})">
		</div>
	</div>
	<div class='form-group'>
		<label class='col-sm-2 hidden-xs control-label' for='addfrm_END_TIME'><span
			class='olx-form-required'>*</span>结束时间</label>
		<div class='col-sm-4'>
			<input type='text' class='form-control WdatePicker' name='END_TIME'
				id='addfrm_END_TIME' placeholder='结束时间'
				value='$!{task.END_TIME}'
				onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',minDate:'#F{$dp.$D(\'addfrm_START_TIME\')}'})">
		</div>
	</div>
	<div class='form-group'>
		<label class='col-sm-2 hidden-xs control-label'
			for='addFrm_TASK_INTRO'><span class='olx-form-required'>*</span>任务简介</label>
		<div class='col-sm-4'>
			<textarea class='form-control' rows='5' name='TASK_INTRO'
				id='addFrm_TASK_INTRO' placeholder='任务简介' required='required'>$!{task.TASK_INTRO}</textarea>
		</div>
	</div>
	<div class='form-group'>
		<label class='col-sm-2 hidden-xs control-label' for='addFrm_SMS_INTRO'><span
			class='olx-form-required'>*</span>短信内容</label>
		<div class='col-sm-4'>
			<textarea class='form-control' rows='5' name='SMS_INTRO'
				id='addFrm_SMS_INTRO' placeholder='短信内容' required='required'>$!{task.SMS_INTRO}</textarea>
		</div>
	</div>
	<div class='form-group'>
		<label class='col-sm-2 hidden-xs control-label' for='addFrm_STATUS'>状态</label>
		<div class='col-sm-4'>
			<select class='form-control' name='STATUS' id='addFrm_STATUS'>
				#m_select_option($!{dict_status}, 'key', 'value', $!{task.STATUS})
			</select>
		</div>
	</div>
	<div class='form-group'>
		<div class='col-sm-offset-2 col-sm-4'>
			<button id='addFrm_btn_submit' type='button' class='btn btn-primary'>保存</button>
		</div>
	</div>
</form>
<script type='text/javascript'
	src='$!{conf.html.cdn}js/My97DatePicker/4.8-Beta4/WdatePicker.js'></script>

<script>
	$('#addFrm_create_user_name')
			.bind(
					'input propertychange',
					function(obj) {
						$
								.ajax({
									url : '$!{conf.html.virtualPath}manage/user/list',
									type : 'POST',
									dataType : 'JSON',
									data : {
										user_name : obj.target.value
									},
									success : function(data) {
										if (!data.success)
											return;
										var html = '';

										for ( var i in data.data) {
											var _data = data.data[i];
											html += '<li><a href="javascript:;" onclick="selItem(\''
													+ _data.id
													+ '\', \''
													+ _data.user_name
													+ '\');">'
													+ _data.user_name + '</li>';
										} // END

										var parent = $(obj.target).parent();

										var ul = parent.find('ul')[0];
										$(ul)
												.html(
														'' === html ? '<li><a href="javascript:;">没找到</li>'
																: html);

										var btn = parent.find('button')[0];
										$(btn).trigger('click');
									},
									error : function() {
										alert(arguments[2]);
									}
								});
					});
	function selItem(id, user_name) {
		$('#addFrm_create_user_id').val(id);
		$('#addFrm_create_user_name').val(user_name);
	}
</script>